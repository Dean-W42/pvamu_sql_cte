-- PULLS FROM CTE A

cell    as (select       "cell_pidm",coalesce(c1,c2,c3,c4,c5,c6,c7)"cell_phone"       
      from (select       "pidm" "cell_pidm",               
           (select       "c1" from(select t.sprtele_pidm"c1_pidm",t.sprtele_phone_area||t.sprtele_phone_number"c1",row_number() over(partition by t.sprtele_pidm order by t.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod t where t.sprtele_primary_ind='Y' and t.sprtele_status_ind is null and t.sprtele_tele_code in('CE','CELL') and regexp_like(t.sprtele_phone_area,'^\d{3}$') and regexp_like(t.sprtele_phone_number,'^\d{7}$') and t.sprtele_pidm in(select "pidm" from a)) where rn=1 and "c1_pidm"="pidm") c1,
           (select       "c2" from(select u.sprtele_pidm"c2_pidm",u.sprtele_phone_area"c2",row_number() over(partition by u.sprtele_pidm order by u.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod u where u.sprtele_primary_ind='Y' and u.sprtele_status_ind is null and u.sprtele_tele_code in('CE','CELL') and regexp_like(u.sprtele_phone_area,'^\d{10}$') and u.sprtele_pidm in(select "pidm" from a)) where rn = 1 and "c2_pidm"="pidm") c2,
           (select       "c3" from(select v.sprtele_pidm"c3_pidm",v.sprtele_phone_area||v.sprtele_phone_number"c3",row_number() over(partition by v.sprtele_pidm order by v.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod v where v.sprtele_status_ind is null and v.sprtele_tele_code in('CE','CELL') and regexp_like(v.sprtele_phone_area,'^\d{3}$') and regexp_like(v.sprtele_phone_number,'^\d{7}$') and v.sprtele_pidm in(select "pidm" from a)) where rn=1 and "c3_pidm"="pidm") c3,
           (select       "c4" from(select w.sprtele_pidm"c4_pidm",w.sprtele_phone_area"c4",row_number() over(partition by w.sprtele_pidm order by w.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod w where w.sprtele_status_ind is null and w.sprtele_tele_code in('CE','CELL') and regexp_like(w.sprtele_phone_area,'^\d{10}$') and w.sprtele_pidm in(select "pidm" from a)) where rn=1 and "c4_pidm"="pidm") c4,
           (select       "c5" from(select x.sprtele_pidm"c5_pidm",x.sprtele_phone_area||x.sprtele_phone_number||x.sprtele_phone_ext"c5",row_number() over(partition by x.sprtele_pidm order by x.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod x where x.sprtele_status_ind is null and x.sprtele_tele_code in('CE','CELL') and regexp_like(x.sprtele_phone_area,'^\d{3}$') and regexp_like(x.sprtele_phone_number,'^\d{3}$') and regexp_like(x.sprtele_phone_ext,'^\d{4}$') and x.sprtele_pidm in(select "pidm" from a)) where rn=1 and "c5_pidm"="pidm") C5,
           (select       "c6" from(select y.sprtele_pidm"c6_pidm",substr(y.sprtele_phone_number,-10)"c6",row_number() over(partition by y.sprtele_pidm order by y.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod y where y.sprtele_status_ind is null and y.sprtele_tele_code in('CE','CELL') and regexp_like(y.sprtele_phone_number,'^\d{12}$') and y.sprtele_pidm in(select "pidm" from a)) where rn=1 and "c6_pidm"="pidm") c6,
           (select       "c7" from(select z.sprtele_pidm"c7_pidm",z.sprtele_phone_number"c7",row_number() over(partition by z.sprtele_pidm order by z.sprtele_surrogate_id desc nulls last) rn from saturn.sprtele@prod z where z.sprtele_status_ind is null and z.sprtele_tele_code in('CE','CELL') and regexp_like(z.sprtele_phone_number,'^\d{10}$') and z.sprtele_pidm in(select "pidm" from a)) where rn=1 and "c7_pidm"="pidm") c7
            from          a))
